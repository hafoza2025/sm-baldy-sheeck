<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ุงููุฎุฒูู ูุงููุตูุงุช - ูุธุงู ุงููุทุนู</title>
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/inventory.css">
</head>
<body>
  <div class="header">
    <div>
      <h1>๐ฆ ุงููุฎุฒูู ูุงููุตูุงุช</h1>
      <span class="live-indicator"></span>
      <span style="font-size: 14px;">ูุจุงุดุฑ</span>
    </div>
    <div class="user-info">
      <span id="userName">ูุฑุญุจุงูุ Admin</span>
      <button class="btn-logout" onclick="Auth.logout()">ุชุณุฌูู ุฎุฑูุฌ</button>
    </div>
  </div>

  <div class="container">
    <!-- ุงูุฅุญุตุงุฆูุงุช -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>ุฅุฌูุงูู ุงูููููุงุช</h3>
        <div class="value" id="totalIngredients">0</div>
      </div>
      <div class="stat-card warning">
        <h3>ููููุงุช ููุฎูุถุฉ</h3>
        <div class="value" id="lowStockCount">0</div>
      </div>
      <div class="stat-card">
        <h3>ุฃุตูุงู ููุง ูุตูุงุช</h3>
        <div class="value" id="totalRecipes">0</div>
      </div>
      <div class="stat-card">
        <h3>ูููุฉ ุงููุฎุฒูู</h3>
        <div class="value" id="totalValue">0 ุฌููู</div>
      </div>
    </div>

    <!-- ุงูุชุจููุจุงุช -->
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('inventory')">
        ๐ฆ ุงููุฎุฒูู
      </button>
      <button class="tab-btn" onclick="switchTab('recipes')">
        ๐ ุงููุตูุงุช
      </button>
      <button class="tab-btn" onclick="switchTab('transactions')">
        ๐ ุญุฑูุฉ ุงููุฎุฒูู
      </button>
    </div>

    <!-- ุชุจููุจ ุงููุฎุฒูู -->
    <div id="inventory" class="tab-content active">
      <div class="action-buttons">
        <button class="btn btn-primary" onclick="openAddIngredientModal()">
          โ ุฅุถุงูุฉ ูููู ุฌุฏูุฏ
        </button>
        <button class="btn btn-export" onclick="exportInventory()">
          ๐ ุชุตุฏูุฑ Excel
        </button>
      </div>

      <!-- ููุงุชุฑ -->
      <div class="filters">
        <input type="text" id="searchIngredient" placeholder="๐ ุงุจุญุซ ุนู ูููู..." 
               onkeyup="filterIngredients()">
        <select id="filterStockStatus" onchange="filterIngredients()">
          <option value="all">ุฌููุน ุงูุญุงูุงุช</option>
          <option value="normal">ุนุงุฏู</option>
          <option value="low">ููุฎูุถ</option>
          <option value="critical">ุญุฑุฌ</option>
        </select>
      </div>

      <table id="inventoryTable">
        <thead>
          <tr>
            <th>ุงููููู</th>
            <th>ุงููููุฉ ุงูุญุงููุฉ</th>
            <th>ุงููุญุฏุฉ</th>
            <th>ุงูุญุฏ ุงูุฃุฏูู</th>
            <th>ุงูุชูููุฉ/ุงููุญุฏุฉ</th>
            <th>ุงููููุฉ ุงูุฅุฌูุงููุฉ</th>
            <th>ุงูุญุงูุฉ</th>
            <th>ุงูุฅุฌุฑุงุกุงุช</th>
          </tr>
        </thead>
        <tbody id="inventoryBody"></tbody>
      </table>
    </div>

    <!-- ุชุจููุจ ุงููุตูุงุช -->
    <div id="recipes" class="tab-content">
      <div class="action-buttons">
        <button class="btn btn-primary" onclick="openAddRecipeModal()">
          โ ุฅุถุงูุฉ ูุตูุฉ ุฌุฏูุฏุฉ
        </button>
        <button class="btn btn-export" onclick="exportRecipes()">
          ๐ ุชุตุฏูุฑ Excel
        </button>
      </div>

      <!-- ุงุฎุชูุงุฑ ุงูุตูู -->
      <div class="filters">
        <select id="menuItemSelect" onchange="loadRecipesForItem()">
          <option value="">-- ุงุฎุชุฑ ุตูู ูู ุงููููู --</option>
        </select>
      </div>

      <div id="recipeContent">
        <div class="empty-state">
          <h3>ุงุฎุชุฑ ุตููุงู ูู ุงููููู ูุนุฑุถ ูุตูุชู</h3>
        </div>
      </div>
    </div>

    <!-- ุชุจููุจ ุญุฑูุฉ ุงููุฎุฒูู -->
    <div id="transactions" class="tab-content">
      <div class="filters">
        <input type="date" id="transactionDateFrom">
        <input type="date" id="transactionDateTo">
        <button class="btn btn-primary" onclick="loadTransactions()">
          ๐ ุจุญุซ
        </button>
        <button class="btn btn-export" onclick="exportTransactions()">
          ๐ ุชุตุฏูุฑ Excel
        </button>
      </div>

      <table id="transactionsTable">
        <thead>
          <tr>
            <th>ุงูุชุงุฑูุฎ</th>
            <th>ุงููููู</th>
            <th>ุงููููุฉ ุงููุณุชุฎุฏูุฉ</th>
            <th>ุฑูู ุงูุทูุจ</th>
            <th>ุงูููุน</th>
          </tr>
        </thead>
        <tbody id="transactionsBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Modal: ุฅุถุงูุฉ ูููู -->
  <div id="addIngredientModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ุฅุถุงูุฉ ูููู ุฌุฏูุฏ</h2>
        <span class="close-modal" onclick="closeAddIngredientModal()">ร</span>
      </div>
      
      <form id="addIngredientForm">
        <div class="form-group">
          <label>ุงุณู ุงููููู *</label>
          <input type="text" id="ingredientName" required>
        </div>
        
        <div class="form-group">
          <label>ุงููุญุฏุฉ *</label>
          <select id="ingredientUnit" required>
            <option value="">-- ุงุฎุชุฑ --</option>
            <option value="ูุฌู">ููููุฌุฑุงู (ูุฌู)</option>
            <option value="ุฌุฑุงู">ุฌุฑุงู</option>
            <option value="ูุชุฑ">ูุชุฑ</option>
            <option value="ูู">ููููุชุฑ (ูู)</option>
            <option value="ูุทุนุฉ">ูุทุนุฉ</option>
            <option value="ุฑุบูู">ุฑุบูู</option>
            <option value="ุนูุจุฉ">ุนูุจุฉ</option>
            <option value="ููุณ">ููุณ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ุงููููุฉ ุงูุญุงููุฉ *</label>
          <input type="number" id="ingredientStock" step="0.01" required>
        </div>
        
        <div class="form-group">
          <label>ุงูุญุฏ ุงูุฃุฏูู *</label>
          <input type="number" id="ingredientMinStock" step="0.01" required>
        </div>
        
        <div class="form-group">
          <label>ุงูุชูููุฉ ููู ูุญุฏุฉ *</label>
          <input type="number" id="ingredientCost" step="0.01" required>
        </div>
        
        <div class="form-group">
          <label>ุงูููุฑุฏ</label>
          <input type="text" id="ingredientSupplier">
        </div>
        
        <button type="submit" class="btn btn-success" style="width: 100%;">
          โ ุญูุธ ุงููููู
        </button>
      </form>
    </div>
  </div>

  <!-- Modal: ุชุนุฏูู ุงููุฎุฒูู -->
  <div id="updateStockModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ุชุญุฏูุซ ุงููุฎุฒูู</h2>
        <span class="close-modal" onclick="closeUpdateStockModal()">ร</span>
      </div>
      
      <form id="updateStockForm">
        <input type="hidden" id="updateIngredientId">
        
        <div class="form-group">
          <label>ุงููููู</label>
          <input type="text" id="updateIngredientName" readonly>
        </div>
        
        <div class="form-group">
          <label>ุงููููุฉ ุงูุญุงููุฉ</label>
          <input type="text" id="updateCurrentStock" readonly>
        </div>
        
        <div class="form-group">
          <label>ููุน ุงูุนูููุฉ *</label>
          <select id="updateType" required onchange="updateStockTypeChanged()">
            <option value="add">ุฅุถุงูุฉ ูููุฎุฒูู</option>
            <option value="deduct">ุฎุตู ูู ุงููุฎุฒูู</option>
            <option value="set">ุชุนููู ุงููููุฉ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label id="updateQuantityLabel">ุงููููุฉ *</label>
          <input type="number" id="updateQuantity" step="0.01" required>
        </div>
        
        <div class="form-group">
          <label>ุงููููุฉ ุงูุฌุฏูุฏุฉ</label>
          <input type="text" id="updateNewStock" readonly>
        </div>
        
        <div class="form-group">
          <label>ููุงุญุธุงุช</label>
          <textarea id="updateNotes" rows="3"></textarea>
        </div>
        
        <button type="submit" class="btn btn-success" style="width: 100%;">
          โ ุชุญุฏูุซ ุงููุฎุฒูู
        </button>
      </form>
    </div>
  </div>

  <!-- Modal: ุฅุถุงูุฉ ูุตูุฉ -->
  <div id="addRecipeModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ุฅุถุงูุฉ ูููู ูููุตูุฉ</h2>
        <span class="close-modal" onclick="closeAddRecipeModal()">ร</span>
      </div>
      
      <form id="addRecipeForm">
        <div class="form-group">
          <label>ุงูุตูู</label>
          <input type="text" id="recipeMenuItem" readonly>
        </div>
        
        <div class="form-group">
          <label>ุงููููู *</label>
          <select id="recipeIngredient" required>
            <option value="">-- ุงุฎุชุฑ ุงููููู --</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ุงููููุฉ ุงููุทููุจุฉ *</label>
          <input type="number" id="recipeQuantity" step="0.001" required>
        </div>
        
        <div class="form-group">
          <label>ุงููุญุฏุฉ</label>
          <input type="text" id="recipeUnit" readonly>
        </div>
        
        <button type="submit" class="btn btn-success" style="width: 100%;">
          โ ุฅุถุงูุฉ ูููุตูุฉ
        </button>
      </form>
    </div>
  </div>

  <!-- ุงูุณูุฑูุจุชุงุช -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="config/keys.js"></script>
  <script src="js/config.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/realtime.js"></script>
  <script src="js/inventory.js"></script>
  
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      InventoryManager.init();
    });
    // ุงูุชุจุฏูู ุจูู ุงูุชุจููุจุงุช
function switchTab(tabName) {
  // ุฅุฒุงูุฉ active ูู ูู ุงูุชุจููุจุงุช
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.remove('active');
  });
  
  // ุฅุถุงูุฉ active ููุชุจููุจ ุงููุฎุชุงุฑ
  event.target.classList.add('active');
  document.getElementById(tabName).classList.add('active');
  
  // ุชุญููู ุงูุจูุงูุงุช ุญุณุจ ุงูุชุจููุจ
  if (tabName === 'transactions') {
    InventoryManager.loadTransactions();
  }
}

  </script>

  <!-- ุฒุฑ Refresh + ูุคุดุฑ ุงูุงุชุตุงู -->
  <!-- ุงูุตู ุงูููุฏ ุงููุงูู ูู ุงูุฑุฏ ุงูุณุงุจู ููุง -->
  
</body>
</html>
