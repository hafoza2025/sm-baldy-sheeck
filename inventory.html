<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>๐ณ ุฅุฏุงุฑุฉ Recipes ูุงููุฎุฒูู - ูุธุงู ุงููุทุนู</title>
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/inventory.css">
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div>
      <h1>๐ณ ุฅุฏุงุฑุฉ Recipes ูุงููุฎุฒูู ุงููุชูุฏูุฉ</h1>
      <span class="live-indicator"></span>
      <span style="font-size: 14px;">ูุชุฒุงูู ูุจุงุดุฑุฉ</span>
    </div>
    <div class="user-info">
      <!-- ุฃุฒุฑุงุฑ ุงูุชุจุฏูู -->
      <div class="view-switcher" style="display: flex; gap: 10px; margin-left: 15px;">
        <button class="btn btn-primary active" id="btnRecipeView" onclick="RecipeManager.switchView('recipe')">
          ๐ณ Recipes
        </button>
        <button class="btn btn-primary" id="btnInventoryView" onclick="RecipeManager.switchView('inventory')">
          ๐ฆ ุงููุฎุฒูู
        </button>
      </div>
      
      <button class="btn btn-primary" onclick="window.location.href='admin-dashboard.html'" style="margin-left: 15px;">
        ๐ ููุญุฉ ุงูุชุญูู
      </button>
      <span id="adminName">ูุฑุญุจุงูุ Admin</span>
      <button class="btn-logout" onclick="Auth.logout()">ุชุณุฌูู ุฎุฑูุฌ</button>
    </div>
  </div>

  <div class="container">
    <!-- Dashboard Statistics -->
    <div class="stats-dashboard">
      <div class="stat-card primary">
        <div class="stat-icon">๐</div>
        <div class="stat-content">
          <h3>ุฃุตูุงู ููุง Recipes</h3>
          <div class="stat-value" id="statsRecipedItems">0</div>
          <small>ูู ุฅุฌูุงูู <span id="statsTotalItems">0</span> ุตูู</small>
        </div>
      </div>

      <div class="stat-card success">
        <div class="stat-icon">โ</div>
        <div class="stat-content">
          <h3>Recipes ูุงููุฉ</h3>
          <div class="stat-value" id="statsCompleteRecipes">0</div>
          <small>ุฌุงูุฒุฉ ููุชุญุถูุฑ</small>
        </div>
      </div>

      <div class="stat-card warning">
        <div class="stat-icon">โ๏ธ</div>
        <div class="stat-content">
          <h3>ููููุงุช ููุฎูุถุฉ</h3>
          <div class="stat-value" id="statsLowStock">0</div>
          <small>ุชุญุชุงุฌ ุฅุนุงุฏุฉ ุชูููู</small>
        </div>
      </div>

      <div class="stat-card info">
        <div class="stat-icon">๐งช</div>
        <div class="stat-content">
          <h3>ุฅุฌูุงูู ุงูููููุงุช</h3>
          <div class="stat-value" id="statsTotalIngredients">0</div>
          <small>ูููู ูุฎุชูู</small>
        </div>
      </div>
    </div>

    <!-- Recipe View (ุงููุงุฌูุฉ ุงูุฃุตููุฉ) -->
    <div class="recipes-layout" id="recipeView">
      <!-- Menu Sidebar -->
      <div class="menu-sidebar">
        <div class="sidebar-header">
          <h2>๐ ูุงุฆูุฉ ุงูุฃุตูุงู</h2>
        </div>

        <div class="search-box">
          <input type="text" id="searchMenuItem" placeholder="๐ ุงุจุญุซ ุนู ุตูู..." 
                 onkeyup="RecipeManager.filterMenuItems()">
        </div>

        <div class="filter-tabs">
          <button class="filter-tab active" data-filter="all" onclick="RecipeManager.setFilter('all')">
            ุงููู (<span id="filterCountAll">0</span>)
          </button>
          <button class="filter-tab" data-filter="has-recipe" onclick="RecipeManager.setFilter('has-recipe')">
            ููุง Recipe (<span id="filterCountHas">0</span>)
          </button>
          <button class="filter-tab" data-filter="no-recipe" onclick="RecipeManager.setFilter('no-recipe')">
            ุจุฏูู Recipe (<span id="filterCountNo">0</span>)
          </button>
        </div>

        <div class="menu-items-list" id="menuItemsList"></div>
      </div>

      <!-- Recipe Editor -->
      <div class="recipe-editor">
        <div class="editor-header">
          <div id="editorPlaceholder" class="editor-placeholder">
            <div class="placeholder-icon">๐ฝ๏ธ</div>
            <h3>ุงุฎุชุฑ ุตููุงู ูู ุงููุงุฆูุฉ</h3>
            <p>ูุจุฏุก ุฅุฏุงุฑุฉ Recipe ุงูุฎุงุตุฉ ุจู</p>
          </div>

          <div id="editorContent" class="editor-content" style="display: none;">
            <!-- Recipe Header -->
            <div class="recipe-header-card">
              <div class="recipe-item-info">
                <img id="recipeItemImage" src="" alt="" class="recipe-item-image">
                <div>
                  <h2 id="recipeItemName">ุงุณู ุงูุตูู</h2>
                  <div class="recipe-meta">
                    <span class="meta-badge">๐ฐ <span id="recipeItemPrice">0</span> ุฌููู</span>
                    <span class="meta-badge">๐ <span id="recipeItemCategory">ูุฆุฉ</span></span>
                    <span class="meta-badge" id="recipeStatus">โ๏ธ ูุง ุชูุฌุฏ ูุตูุฉ</span>
                  </div>
                </div>
              </div>
              <div class="recipe-actions">
                <button class="btn btn-success" onclick="RecipeManager.openAddIngredientModal()">
                  โ ุฅุถุงูุฉ ูููู
                </button>
                <button class="btn btn-export" onclick="RecipeManager.exportCurrentRecipe()">
                  ๐ ุชุตุฏูุฑ
                </button>
                <button class="btn btn-danger" onclick="RecipeManager.clearAllRecipe()">
                  ๐๏ธ ูุณุญ ุงููู
                </button>
              </div>
            </div>

            <!-- Cost Calculator -->
            <div class="cost-calculator">
              <h3>๐ฐ ุญุงุณุจุฉ ุงูุชูููุฉ</h3>
              <div class="cost-grid">
                <div class="cost-item">
                  <label>ุชูููุฉ ุงูููููุงุช:</label>
                  <strong id="costIngredients">0.00 ุฌููู</strong>
                </div>
                <div class="cost-item">
                  <label>ูุงูุด ุงูุฑุจุญ:</label>
                  <input type="number" id="profitMargin" value="200" min="0" step="10" 
                         onchange="RecipeManager.calculateCosts()" style="width: 80px;">
                  <span>%</span>
                </div>
                <div class="cost-item success">
                  <label>ุงูุณุนุฑ ุงูููุชุฑุญ:</label>
                  <strong id="suggestedPrice">0.00 ุฌููู</strong>
                </div>
                <div class="cost-item">
                  <label>ุงูุณุนุฑ ุงูุญุงูู:</label>
                  <strong id="currentPrice">0.00 ุฌููู</strong>
                </div>
              </div>
            </div>

            <!-- Ingredients Table -->
            <div class="ingredients-section">
              <h3>๐งช ููููุงุช Recipe</h3>
              
              <div id="emptyRecipeState" class="empty-state">
                <p>ูุง ุชูุฌุฏ ููููุงุช ูู ูุฐู ุงููุตูุฉ</p>
                <button class="btn btn-primary" onclick="RecipeManager.openAddIngredientModal()">
                  โ ุงุจุฏุฃ ุจุฅุถุงูุฉ ุงูููููุงุช
                </button>
              </div>

              <div id="ingredientsTable" style="display: none;">
                <table class="ingredients-table">
                  <thead>
                    <tr>
                      <th width="35%">ุงููููู</th>
                      <th width="15%">ุงููููุฉ ุงููุทููุจุฉ</th>
                      <th width="15%">ุงููุฎุฒูู ุงูุญุงูู</th>
                      <th width="15%">ุงูุชูููุฉ</th>
                      <th width="10%">ุงูุญุงูุฉ</th>
                      <th width="10%">ุงูุฅุฌุฑุงุกุงุช</th>
                    </tr>
                  </thead>
                  <tbody id="ingredientsBody"></tbody>
                  <tfoot>
                    <tr class="total-row">
                      <td colspan="3"><strong>ุงูุฅุฌูุงูู:</strong></td>
                      <td><strong id="totalCost">0.00 ุฌููู</strong></td>
                      <td colspan="2"></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>

            <!-- Kitchen Preview -->
            <div class="kitchen-preview">
              <h3>๐จโ๐ณ ูุนุงููุฉ ุงููุทุจุฎ</h3>
              <div class="preview-card">
                <p>ูุฐุง ูุง ุณูุฑุงู ุงูุทุงูู ูู ุดุงุดุฉ ุงููุทุจุฎ:</p>
                <div class="kitchen-card-preview" id="kitchenPreview"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Inventory Panel -->
      <div class="inventory-panel">
        <div class="panel-header">
          <h2>๐ฆ ุญุงูุฉ ุงููุฎุฒูู</h2>
          <button class="btn btn-sm btn-refresh" onclick="RecipeManager.refreshInventory()">๐</button>
        </div>

        <div class="quick-stats">
          <div class="quick-stat green">
            <div class="stat-label">ูุชููุฑ</div>
            <div class="stat-number" id="quickStatsAvailable">0</div>
          </div>
          <div class="quick-stat orange">
            <div class="stat-label">ููุฎูุถ</div>
            <div class="stat-number" id="quickStatsLow">0</div>
          </div>
          <div class="quick-stat red">
            <div class="stat-label">ุญุฑุฌ</div>
            <div class="stat-number" id="quickStatsCritical">0</div>
          </div>
        </div>

        <div class="inventory-list" id="inventoryList"></div>
      </div>
    </div>

    <!-- Inventory Management View (ุฌุฏูุฏ) -->
    <div class="inventory-management-section" style="display: none;" id="inventoryView">
      <div class="section-header">
        <h2>๐ฆ ุฅุฏุงุฑุฉ ุงููุฎุฒูู ุงููุงููุฉ</h2>
        <div class="section-actions">
          <button class="btn btn-success" onclick="RecipeManager.openAddInventoryModal()">
            โ ุฅุถุงูุฉ ูููู ุฌุฏูุฏ
          </button>
          <button class="btn btn-export" onclick="RecipeManager.exportInventory()">
            ๐ ุชุตุฏูุฑ Excel
          </button>
        </div>
      </div>

      <div class="inventory-filters">
        <input type="text" id="inventorySearch" placeholder="๐ ุงุจุญุซ ุนู ูููู..." 
               onkeyup="RecipeManager.filterInventory()">
        <select id="inventoryStatusFilter" onchange="RecipeManager.filterInventory()">
          <option value="all">ุฌููุน ุงูุญุงูุงุช</option>
          <option value="ok">โ ูุชููุฑ</option>
          <option value="low">โ๏ธ ููุฎูุถ</option>
          <option value="critical">๐ด ุญุฑุฌ</option>
        </select>
      </div>

      <div class="inventory-table-container">
        <table class="inventory-table">
          <thead>
            <tr>
              <th width="25%">ุงููููู</th>
              <th width="12%">ุงููููุฉ ุงูุญุงููุฉ</th>
              <th width="10%">ุงูุญุฏ ุงูุฃุฏูู</th>
              <th width="12%">ุงูุชูููุฉ/ุงููุญุฏุฉ</th>
              <th width="12%">ุงููููุฉ ุงูุฅุฌูุงููุฉ</th>
              <th width="12%">ุงูููุฑุฏ</th>
              <th width="10%">ุงูุญุงูุฉ</th>
              <th width="7%">ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody id="inventoryTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modals -->
  
  <!-- Modal: Add Ingredient to Recipe -->
  <div id="addIngredientModal" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>โ ุฅุถุงูุฉ ูููู ููู Recipe</h2>
        <span class="close-modal" onclick="RecipeManager.closeAddIngredientModal()">ร</span>
      </div>
      
      <form id="addIngredientForm">
        <div class="ingredient-selector">
          <div class="form-group">
            <label>ุงุฎุชุฑ ุงููููู *</label>
            <select id="ingredientSelect" required onchange="RecipeManager.ingredientSelected()">
              <option value="">-- ุงุฎุชุฑ ุงููููู --</option>
            </select>
          </div>

          <div id="ingredientDetails" class="ingredient-details" style="display: none;">
            <div class="detail-grid">
              <div class="detail-item">
                <label>ุงููุญุฏุฉ:</label>
                <span id="detailUnit">-</span>
              </div>
              <div class="detail-item">
                <label>ุงููุฎุฒูู ุงูุญุงูู:</label>
                <span id="detailStock">-</span>
              </div>
              <div class="detail-item">
                <label>ุงูุชูููุฉ/ุงููุญุฏุฉ:</label>
                <span id="detailCost">-</span>
              </div>
              <div class="detail-item">
                <label>ุงูุญุงูุฉ:</label>
                <span id="detailStatus">-</span>
              </div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>ุงููููุฉ ุงููุทููุจุฉ (ููุทุนุฉ ูุงุญุฏุฉ) *</label>
          <div class="quantity-input-group">
            <input type="number" id="ingredientQuantity" step="0.001" min="0.001" required 
                   onchange="RecipeManager.calculateIngredientCost()">
            <span class="unit-label" id="quantityUnit">ูุญุฏุฉ</span>
          </div>
          <small class="help-text">ุงููููุฉ ุงููุทููุจุฉ ูุชุญุถูุฑ ูุญุฏุฉ ูุงุญุฏุฉ ูู ุงูุตูู</small>
        </div>

        <div class="cost-preview">
          <div class="cost-preview-item">
            <label>ุชูููุฉ ูุฐุง ุงููููู:</label>
            <strong id="previewCost">0.00 ุฌููู</strong>
          </div>
          <div class="cost-preview-item">
            <label>ูููู ูุนุฏุฏ:</label>
            <strong id="previewServings">0 ูุทุนุฉ</strong>
          </div>
        </div>

        <button type="submit" class="btn btn-success btn-block">
          โ ุฅุถุงูุฉ ุงููููู ููู Recipe
        </button>
      </form>
    </div>
  </div>

  <!-- Modal: Edit Recipe Ingredient -->
  <div id="editIngredientModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>โ๏ธ ุชุนุฏูู ุงููููู</h2>
        <span class="close-modal" onclick="RecipeManager.closeEditIngredientModal()">ร</span>
      </div>
      
      <form id="editIngredientForm">
        <input type="hidden" id="editRecipeId">
        
        <div class="form-group">
          <label>ุงููููู</label>
          <input type="text" id="editIngredientName" readonly>
        </div>

        <div class="form-group">
          <label>ุงููููุฉ ุงููุทููุจุฉ *</label>
          <div class="quantity-input-group">
            <input type="number" id="editIngredientQuantity" step="0.001" min="0.001" required>
            <span class="unit-label" id="editQuantityUnit">ูุญุฏุฉ</span>
          </div>
        </div>

        <button type="submit" class="btn btn-success btn-block">
          โ ุญูุธ ุงูุชุนุฏููุงุช
        </button>
      </form>
    </div>
  </div>

  <!-- Modal: Add Inventory Item -->
  <div id="addInventoryModal" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>โ ุฅุถุงูุฉ ูููู ุฌุฏูุฏ ูููุฎุฒูู</h2>
        <span class="close-modal" onclick="RecipeManager.closeAddInventoryModal()">ร</span>
      </div>
      
      <form id="addInventoryForm">
        <div class="form-row">
          <div class="form-group">
            <label>ุงุณู ุงููููู *</label>
            <input type="text" id="newIngredientName" required placeholder="ูุซุงู: ุฏุฌุงุฌุ ุฃุฑุฒุ ุฒูุช">
          </div>

          <div class="form-group">
            <label>ุงููุญุฏุฉ *</label>
            <select id="newIngredientUnit" required>
              <option value="">-- ุงุฎุชุฑ --</option>
              <option value="ูุฌู">ููููุฌุฑุงู (ูุฌู)</option>
              <option value="ุฌุฑุงู">ุฌุฑุงู</option>
              <option value="ูุชุฑ">ูุชุฑ</option>
              <option value="ูู">ููููุชุฑ (ูู)</option>
              <option value="ูุทุนุฉ">ูุทุนุฉ</option>
              <option value="ุฑุบูู">ุฑุบูู</option>
              <option value="ุนูุจุฉ">ุนูุจุฉ</option>
              <option value="ููุณ">ููุณ</option>
              <option value="ุญุฒูุฉ">ุญุฒูุฉ</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>ุงููููุฉ ุงูุญุงููุฉ *</label>
            <input type="number" id="newIngredientStock" step="0.01" min="0" required 
                   oninput="RecipeManager.calculateInventorySummary()">
          </div>

          <div class="form-group">
            <label>ุงูุญุฏ ุงูุฃุฏูู *</label>
            <input type="number" id="newIngredientMinStock" step="0.01" min="0" required>
            <small class="help-text">ุณูุชู ุงูุชูุจูู ุนูุฏ ุงููุตูู ููุฐุง ุงูุญุฏ</small>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>ุงูุชูููุฉ ููู ูุญุฏุฉ (ุฌููู) *</label>
            <input type="number" id="newIngredientCost" step="0.01" min="0" required 
                   oninput="RecipeManager.calculateInventorySummary()">
          </div>

          <div class="form-group">
            <label>ุงูููุฑุฏ</label>
            <input type="text" id="newIngredientSupplier" placeholder="ุงุฎุชูุงุฑู">
          </div>
        </div>

        <div class="cost-summary" style="background: #e8ecff; padding: 15px; border-radius: 8px; margin: 20px 0;">
          <h4 style="margin: 0 0 10px 0;">๐ ููุฎุต ุงูุชูููุฉ</h4>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
            <div>
              <label>ุงููููุฉ:</label>
              <strong id="summaryQuantity">0</strong>
            </div>
            <div>
              <label>ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ:</label>
              <strong id="summaryCost">0.00 ุฌููู</strong>
            </div>
          </div>
        </div>

        <button type="submit" class="btn btn-success btn-block">
          โ ุฅุถุงูุฉ ุงููููู
        </button>
      </form>
    </div>
  </div>

  <!-- Modal: Update Stock -->
  <div id="updateStockModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>๐ฆ ุชุญุฏูุซ ุงููุฎุฒูู</h2>
        <span class="close-modal" onclick="RecipeManager.closeUpdateStockModal()">ร</span>
      </div>
      
      <form id="updateStockForm">
        <input type="hidden" id="updateIngredientId">
        
        <div class="form-group">
          <label>ุงููููู</label>
          <input type="text" id="updateIngredientName" readonly>
        </div>

        <div class="form-group">
          <label>ุงููููุฉ ุงูุญุงููุฉ</label>
          <div style="padding: 12px; background: #f9f9f9; border-radius: 6px; font-weight: bold;">
            <span id="updateCurrentStock">0</span>
          </div>
        </div>

        <div class="form-group">
          <label>ููุน ุงูุนูููุฉ *</label>
          <select id="updateStockType" required onchange="RecipeManager.updateStockTypeChanged()">
            <option value="add">โ ุฅุถุงูุฉ ูููุฎุฒูู</option>
            <option value="deduct">โ ุฎุตู ูู ุงููุฎุฒูู</option>
            <option value="set">โ๏ธ ุชุนููู ุงููููุฉ</option>
          </select>
        </div>

        <div class="form-group">
          <label id="updateQuantityLabel">ุงููููุฉ *</label>
          <input type="number" id="updateQuantity" step="0.01" min="0" required 
                 oninput="RecipeManager.calculateNewStock()">
        </div>

        <div class="form-group">
          <label>ุงููููุฉ ุงูุฌุฏูุฏุฉ</label>
          <div style="padding: 12px; background: #d4edda; border-radius: 6px; font-weight: bold; color: #155724;">
            <span id="updateNewStock">0</span>
          </div>
        </div>

        <div class="form-group">
          <label>ููุงุญุธุงุช</label>
          <textarea id="updateNotes" rows="3" placeholder="ุณุจุจ ุงูุชุญุฏูุซ (ุงุฎุชูุงุฑู)"></textarea>
        </div>

        <button type="submit" class="btn btn-success btn-block">
          โ ุชุญุฏูุซ ุงููุฎุฒูู
        </button>
      </form>
    </div>
  </div>

  <!-- Modal: Edit Inventory Item -->
  <div id="editInventoryModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>โ๏ธ ุชุนุฏูู ุงููููู</h2>
        <span class="close-modal" onclick="RecipeManager.closeEditInventoryModal()">ร</span>
      </div>
      
      <form id="editInventoryForm">
        <input type="hidden" id="editInventoryId">
        
        <div class="form-group">
          <label>ุงุณู ุงููููู *</label>
          <input type="text" id="editInventoryName" required>
        </div>

        <div class="form-group">
          <label>ุงููุญุฏุฉ *</label>
          <select id="editInventoryUnit" required>
            <option value="ูุฌู">ููููุฌุฑุงู (ูุฌู)</option>
            <option value="ุฌุฑุงู">ุฌุฑุงู</option>
            <option value="ูุชุฑ">ูุชุฑ</option>
            <option value="ูู">ููููุชุฑ (ูู)</option>
            <option value="ูุทุนุฉ">ูุทุนุฉ</option>
            <option value="ุฑุบูู">ุฑุบูู</option>
            <option value="ุนูุจุฉ">ุนูุจุฉ</option>
            <option value="ููุณ">ููุณ</option>
            <option value="ุญุฒูุฉ">ุญุฒูุฉ</option>
          </select>
        </div>

        <div class="form-group">
          <label>ุงูุญุฏ ุงูุฃุฏูู *</label>
          <input type="number" id="editInventoryMinStock" step="0.01" min="0" required>
        </div>

        <div class="form-group">
          <label>ุงูุชูููุฉ/ุงููุญุฏุฉ *</label>
          <input type="number" id="editInventoryCost" step="0.01" min="0" required>
        </div>

        <div class="form-group">
          <label>ุงูููุฑุฏ</label>
          <input type="text" id="editInventorySupplier">
        </div>

        <button type="submit" class="btn btn-success btn-block">
          โ ุญูุธ ุงูุชุนุฏููุงุช
        </button>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="config/keys.js"></script>
  <script src="js/config.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/realtime.js"></script>
  <script src="js/inventory.js"></script>
  
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      RecipeManager.init();
    });
  </script>

  <!-- ุฒุฑ Refresh + ูุคุดุฑ ุงูุงุชุตุงู (ุถุน ุงูููุฏ ุงููุงูู ูู ุงูุฑุฏ ุงูุณุงุจู) -->
  
</body>
</html>
