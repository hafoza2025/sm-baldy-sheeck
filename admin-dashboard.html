<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>๐๏ธ ููุญุฉ ุชุญูู ุงููุฏูุฑ - ูุธุงู ุงููุทุนู</title>
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
    <div class="header">
        <div>
            <h1>๐๏ธ ููุญุฉ ุชุญูู ุงููุฏูุฑ</h1>
            <span class="live-indicator"></span>
            <span style="font-size: 14px;">ูุจุงุดุฑ โข ูุญุธู</span>
        </div>
        <div class="user-info">
            <a href="inventoryr.html" class="btn btn-primary" style="margin-left: 15px; background: rgba(255,255,255,0.2); border: 2px solid white; padding: 8px 16px; border-radius: 6px; text-decoration: none; color: white; font-weight: 600;">
                ๐ณ ุฅุฏุงุฑุฉ Recipes
            </a>
            <span id="adminName">ูุฑุญุจุงูุ Admin</span>
            <button class="btn-logout" onclick="Auth.logout()">ุชุณุฌูู ุฎุฑูุฌ</button>
        </div>
    </div>

    <div class="container">
        <!-- ุงูุฅุญุตุงุฆูุงุช ุงูุฑุฆูุณูุฉ ุงููุญุธูุฉ -->
        <div class="stats-grid" style="margin-bottom: 30px;">
            <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                <h3 style="color: rgba(255,255,255,0.9);">๐ฐ ุฅูุฑุงุฏุงุช ุงูููู</h3>
                <div class="value" style="color: white; font-size: 36px;" id="todayRevenue">0 ุฌููู</div>
                <div class="change" style="color: rgba(255,255,255,0.9); font-size: 13px;">
                    <span id="revenueChange">+0%</span> ุนู ุงูุฃูุณ
                </div>
            </div>

            <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none;">
                <h3 style="color: rgba(255,255,255,0.9);">๐ ุทูุจุงุช ุงูููู</h3>
                <div class="value" style="color: white; font-size: 36px;" id="todayOrdersCount">0</div>
                <div class="change" style="color: rgba(255,255,255,0.9); font-size: 13px;">
                    ูุชูุณุท ุงููุงุชูุฑุฉ: <span id="avgOrderValue">0 ุฌููู</span>
                </div>
            </div>

            <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none;">
                <h3 style="color: rgba(255,255,255,0.9);">๐ฅ ุทูุจุงุช ูุดุทุฉ ุงูุขู</h3>
                <div class="value" style="color: white; font-size: 36px;" id="activeOrders">0</div>
                <div class="change" style="color: rgba(255,255,255,0.9); font-size: 13px;">
                    ุฌุฏูุฏ: <span id="newOrders">0</span> โข ููุฏ ุงูุชุญุถูุฑ: <span id="preparingOrders">0</span>
                </div>
            </div>

            <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; border: none;">
                <h3 style="color: rgba(255,255,255,0.9);">๐ต ุตุงูู ุงูุฑุจุญ ุงูููู</h3>
                <div class="value" style="color: white; font-size: 36px;" id="todayProfit">0 ุฌููู</div>
                <div class="change" style="color: rgba(255,255,255,0.9); font-size: 13px;">
                    ูุงูุด: <span id="profitMargin">0%</span>
                </div>
            </div>
        </div>

        <!-- ุงููุจูุนุงุช ูุงูุชูุงููู -->
        <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; font-size: 20px;">๐ ููุฎุต ุงููุจูุนุงุช ูุงูุชูุงููู</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="tab-btn active" onclick="AdminDashboard.setTimeFilter('today')" style="padding: 8px 16px; font-size: 14px;">ุงูููู</button>
                    <button class="tab-btn" onclick="AdminDashboard.setTimeFilter('week')" style="padding: 8px 16px; font-size: 14px;">ุงูุฃุณุจูุน</button>
                    <button class="tab-btn" onclick="AdminDashboard.setTimeFilter('month')" style="padding: 8px 16px; font-size: 14px;">ุงูุดูุฑ</button>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="background: #f0f4ff; padding: 15px; border-radius: 8px; border-right: 4px solid #667eea;">
                    <div style="font-size: 13px; color: #666; margin-bottom: 5px;">ุฅุฌูุงูู ุงููุจูุนุงุช</div>
                    <div style="font-size: 24px; font-weight: bold; color: #667eea;" id="totalSales">0 ุฌููู</div>
                </div>
                <div style="background: #fff3f0; padding: 15px; border-radius: 8px; border-right: 4px solid #f44336;">
                    <div style="font-size: 13px; color: #666; margin-bottom: 5px;">ุชูููุฉ ุงูููููุงุช</div>
                    <div style="font-size: 24px; font-weight: bold; color: #f44336;" id="ingredientsCost">0 ุฌููู</div>
                </div>
                <div style="background: #f0fff4; padding: 15px; border-radius: 8px; border-right: 4px solid #4caf50;">
                    <div style="font-size: 13px; color: #666; margin-bottom: 5px;">ุตุงูู ุงูุฑุจุญ</div>
                    <div style="font-size: 24px; font-weight: bold; color: #4caf50;" id="netProfit">0 ุฌููู</div>
                </div>
                <div style="background: #fff9e6; padding: 15px; border-radius: 8px; border-right: 4px solid #ff9800;">
                    <div style="font-size: 13px; color: #666; margin-bottom: 5px;">ุงูุฎุณุงุฆุฑ</div>
                    <div style="font-size: 24px; font-weight: bold; color: #ff9800;" id="totalLosses">0 ุฌููู</div>
                </div>
            </div>
        </div>

        <!-- ุงููุฎุฒูู ูุงูุทูุจุงุช -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 20px;">
            <!-- ุญุงูุฉ ุงููุฎุฒูู -->
            <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h2 style="margin: 0 0 20px 0; font-size: 18px;">๐ฆ ุญุงูุฉ ุงููุฎุฒูู</h2>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 15px; background: #d4edda; border-radius: 8px;">
                        <div style="font-size: 32px; font-weight: bold; color: #155724;" id="stockAvailable">0</div>
                        <div style="font-size: 13px; color: #155724;">โ ูุชููุฑ</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #fff3cd; border-radius: 8px;">
                        <div style="font-size: 32px; font-weight: bold; color: #856404;" id="stockLow">0</div>
                        <div style="font-size: 13px; color: #856404;">โ๏ธ ููุฎูุถ</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8d7da; border-radius: 8px;">
                        <div style="font-size: 32px; font-weight: bold; color: #721c24;" id="stockCritical">0</div>
                        <div style="font-size: 13px; color: #721c24;">๐ด ุญุฑุฌ</div>
                    </div>
                </div>
                <div style="background: #f9f9f9; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 13px; color: #666; margin-bottom: 5px;">ูููุฉ ุงููุฎุฒูู ุงูุฅุฌูุงููุฉ</div>
                    <div style="font-size: 28px; font-weight: bold; color: #667eea;" id="inventoryValue">0 ุฌููู</div>
                </div>
                <div id="criticalItemsList" style="margin-top: 15px; max-height: 150px; overflow-y: auto;">
                    <!-- ูุชู ููุคู ุฏููุงููููุงู -->
                </div>
            </div>

            <!-- ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช -->
            <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h2 style="margin: 0 0 20px 0; font-size: 18px;">๐ ุชูุตูู ุงูุทูุจุงุช</h2>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #f0fff4; border-radius: 6px; border-right: 3px solid #4caf50;">
                        <span style="font-weight: 600;">โ ููุชููุฉ</span>
                        <span style="font-weight: bold; color: #4caf50;" id="completedOrders">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #fff3e0; border-radius: 6px; border-right: 3px solid #ff9800;">
                        <span style="font-weight: 600;">๐ ููุฏ ุงูุชุญุถูุฑ</span>
                        <span style="font-weight: bold; color: #ff9800;" id="preparingOrdersStat">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #e3f2fd; border-radius: 6px; border-right: 3px solid #2196f3;">
                        <span style="font-weight: 600;">๐ ุฌุฏูุฏุฉ</span>
                        <span style="font-weight: bold; color: #2196f3;" id="newOrdersStat">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #ffebee; border-radius: 6px; border-right: 3px solid #f44336;">
                        <span style="font-weight: 600;">โ ููุบุงุฉ</span>
                        <span style="font-weight: bold; color: #f44336;" id="cancelledOrders">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #f9f9f9; border-radius: 6px;">
                        <span style="font-weight: 600;">๐ฝ๏ธ ุฏุงุฎูู (Dine-in)</span>
                        <span style="font-weight: bold;" id="dineInOrders">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #f9f9f9; border-radius: 6px;">
                        <span style="font-weight: 600;">๐ต ุชูุตูู (Delivery)</span>
                        <span style="font-weight: bold;" id="deliveryOrders">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ุงูุทุงููุงุช ูุงูุฏููููุฑู -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 20px;">
            <!-- ุญุงูุฉ ุงูุทุงููุงุช -->
            <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h2 style="margin: 0 0 20px 0; font-size: 18px;">๐ฝ๏ธ ุญุงูุฉ ุงูุทุงููุงุช</h2>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px;">
                    <div style="text-align: center; padding: 12px; background: #d4edda; border-radius: 6px;">
                        <div style="font-size: 24px; font-weight: bold; color: #155724;" id="tablesAvailable">0</div>
                        <div style="font-size: 12px; color: #155724;">ูุชุงุญุฉ</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: #f8d7da; border-radius: 6px;">
                        <div style="font-size: 24px; font-weight: bold; color: #721c24;" id="tablesOccupied">0</div>
                        <div style="font-size: 12px; color: #721c24;">ูุดุบููุฉ</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: #fff3cd; border-radius: 6px;">
                        <div style="font-size: 24px; font-weight: bold; color: #856404;" id="tablesReserved">0</div>
                        <div style="font-size: 12px; color: #856404;">ูุญุฌูุฒุฉ</div>
                    </div>
                </div>
                <div style="background: #f9f9f9; padding: 12px; border-radius: 6px;">
                    <div style="font-size: 13px; color: #666; margin-bottom: 8px;">ูุณุจุฉ ุงูุฅุดุบุงู</div>
                    <div style="background: #e0e0e0; height: 20px; border-radius: 10px; overflow: hidden;">
                        <div id="occupancyBar" style="background: linear-gradient(90deg, #4caf50 0%, #ff9800 100%); height: 100%; width: 0%; transition: width 0.3s;"></div>
                    </div>
                    <div style="text-align: center; margin-top: 5px; font-weight: bold; font-size: 16px; color: #667eea;" id="occupancyRate">0%</div>
                </div>
            </div>

            <!-- ุญุงูุฉ ุงูุชูุตูู -->
            <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h2 style="margin: 0 0 20px 0; font-size: 18px;">๐ต ุญุงูุฉ ุงูุชูุตูู</h2>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <div style="display: flex; justify-content: space-between; padding: 10px; background: #fff3e0; border-radius: 6px;">
                        <span>ููุฏ ุงูุชุญุถูุฑ</span>
                        <span style="font-weight: bold;" id="deliveryPreparing">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 10px; background: #e3f2fd; border-radius: 6px;">
                        <span>ุฌุงูุฒ ููุชูุตูู</span>
                        <span style="font-weight: bold;" id="deliveryReady">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 10px; background: #fff9c4; border-radius: 6px;">
                        <span>ูู ุงูุทุฑูู</span>
                        <span style="font-weight: bold;" id="deliveryOnWay">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 10px; background: #d4edda; border-radius: 6px;">
                        <span>ุชู ุงูุชูุตูู ุงูููู</span>
                        <span style="font-weight: bold;" id="deliveryDelivered">0</span>
                    </div>
                </div>
                <div style="background: #f9f9f9; padding: 12px; border-radius: 6px; margin-top: 15px; text-align: center;">
                    <div style="font-size: 13px; color: #666; margin-bottom: 5px;">ูุชูุณุท ููุช ุงูุชูุตูู</div>
                    <div style="font-size: 24px; font-weight: bold; color: #667eea;" id="avgDeliveryTime">0 ุฏูููุฉ</div>
                </div>
            </div>

            <!-- ุฃูุซุฑ ุงูุฃุตูุงู ูุจูุนุงู -->
            <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h2 style="margin: 0 0 20px 0; font-size: 18px;">๐ ุฃูุซุฑ ุงูุฃุตูุงู ูุจูุนุงู</h2>
                <div id="topSellingItems" style="display: flex; flex-direction: column; gap: 10px;">
                    <!-- ูุชู ููุคูุง ุฏููุงููููุงู -->
                </div>
            </div>
        </div>

        <!-- ุงูุชุจููุจุงุช ุงูุฃุตููุฉ -->
        <div class="tabs">
            <button class="tab-btn active" onclick="AdminDashboard.switchTab('current')">ุงูุทูุจุงุช ุงูุญุงููุฉ</button>
            <button class="tab-btn" onclick="AdminDashboard.switchTab('orders')">ุฌููุน ุงูุทูุจุงุช</button>
            <button class="tab-btn" onclick="AdminDashboard.switchTab('users')">ุงููุณุชุฎุฏููู</button>
            <button class="tab-btn" onclick="AdminDashboard.switchTab('deliveries')">ุงูุชูุตูู</button>
            <button class="tab-btn" onclick="AdminDashboard.switchTab('inventory')">ุงููุฎุฒูู</button>
        </div>

        <!-- Current Orders Tab -->
        <div id="currentTab" class="tab-content active">
            <h2>ุงูุทูุจุงุช ุงูุญุงููุฉ</h2>
            <table>
                <thead>
                    <tr>
                        <th>ุฑูู ุงูุทูุจ</th>
                        <th>ุงูููุน</th>
                        <th>ุงูุทุงููุฉ/ุงูุนููู</th>
                        <th>ุงูุญุงูุฉ</th>
                        <th>ุงูุฅุฌูุงูู</th>
                        <th>ุงูููุช</th>
                    </tr>
                </thead>
                <tbody id="currentOrdersBody"></tbody>
            </table>
        </div>

        <!-- Orders Tab -->
        <div id="ordersTab" class="tab-content">
            <div class="filters">
                <input type="date" id="orderDateFrom" placeholder="ูู ุชุงุฑูุฎ">
                <input type="date" id="orderDateTo" placeholder="ุฅูู ุชุงุฑูุฎ">
                <select id="orderTypeFilter">
                    <option value="">ุฌููุน ุงูุฃููุงุน</option>
                    <option value="dine_in">ุฏุงุฎูู</option>
                    <option value="delivery">ุชูุตูู</option>
                </select>
                <select id="orderStatusFilter">
                    <option value="">ุฌููุน ุงูุญุงูุงุช</option>
                    <option value="new">ุฌุฏูุฏ</option>
                    <option value="preparing">ููุฏ ุงูุชุญุถูุฑ</option>
                    <option value="ready">ุฌุงูุฒ</option>
                    <option value="completed">ููุชูู</option>
                </select>
                <button class="btn btn-primary" onclick="AdminDashboard.filterOrders()">ุจุญุซ</button>
                <button class="btn btn-export" onclick="AdminDashboard.exportOrders()">ุชุตุฏูุฑ Excel</button>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ุฑูู ุงูุทูุจ</th>
                        <th>ุงูุชุงุฑูุฎ</th>
                        <th>ุงูููุน</th>
                        <th>ุงูุทุงููุฉ/ุงูุนููู</th>
                        <th>ุงูููุธู</th>
                        <th>ุงูุฅุฌูุงูู</th>
                        <th>ุงูุญุงูุฉ</th>
                    </tr>
                </thead>
                <tbody id="ordersBody"></tbody>
            </table>
        </div>

        <!-- Users Tab -->
        <div id="usersTab" class="tab-content">
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="AdminDashboard.openAddUserModal()">โ ุฅุถุงูุฉ ูุณุชุฎุฏู</button>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ุงูุงุณู</th>
                        <th>ุงุณู ุงููุณุชุฎุฏู</th>
                        <th>ุงูุฏูุฑ</th>
                        <th>ุงูููุจุงูู</th>
                        <th>ุงูุญุงูุฉ</th>
                        <th>ุงูุฅุฌุฑุงุกุงุช</th>
                    </tr>
                </thead>
                <tbody id="usersBody"></tbody>
            </table>
        </div>

        <!-- Deliveries Tab -->
        <div id="deliveriesTab" class="tab-content">
            <table>
                <thead>
                    <tr>
                        <th>ุฑูู ุงูุทูุจ</th>
                        <th>ุงุณู ุงูุนููู</th>
                        <th>ุงูููุจุงูู</th>
                        <th>ุงูุนููุงู</th>
                        <th>ุงูููุฏูุจ</th>
                        <th>ุฑุณูู ุงูุชูุตูู</th>
                        <th>ุงูุญุงูุฉ</th>
                        <th>ุงูููุช</th>
                    </tr>
                </thead>
                <tbody id="deliveriesBody"></tbody>
            </table>
        </div>

        <!-- Inventory Tab -->
        <div id="inventoryTab" class="tab-content">
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="window.location.href='recipes-manager.html'">ุฅุฏุงุฑุฉ ุงููุฎุฒูู ุงููุงููุฉ</button>
                <button class="btn btn-export" onclick="AdminDashboard.exportInventory()">ุชุตุฏูุฑ Excel</button>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ุงููููู</th>
                        <th>ุงููููุฉ ุงูุญุงููุฉ</th>
                        <th>ุงููุญุฏุฉ</th>
                        <th>ุงูุญุฏ ุงูุฃุฏูู</th>
                        <th>ุงูุชูููุฉ ููู ูุญุฏุฉ</th>
                        <th>ุงูุญุงูุฉ</th>
                    </tr>
                </thead>
                <tbody id="inventoryBody"></tbody>
            </table>
        </div>
    </div>

    <!-- Modal: Add User -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ</h2>
                <span class="close-modal" onclick="AdminDashboard.closeAddUserModal()">ร</span>
            </div>
            <form id="addUserForm">
                <div class="form-group">
                    <label>ุงูุงุณู ุงููุงูู *</label>
                    <input type="text" id="userFullName" required>
                </div>
                <div class="form-group">
                    <label>ุงุณู ุงููุณุชุฎุฏู *</label>
                    <input type="text" id="userUsername" required>
                </div>
                <div class="form-group">
                    <label>ูููุฉ ุงููุฑูุฑ *</label>
                    <input type="password" id="userPassword" required>
                </div>
                <div class="form-group">
                    <label>ุงูุฏูุฑ *</label>
                    <select id="userRole" required>
                        <option value="">-- ุงุฎุชุฑ --</option>
                        <option value="admin">ูุฏูุฑ</option>
                        <option value="cashier">ูุงุดูุฑ</option>
                        <option value="staff">ููุธู</option>
                        <option value="kitchen">ูุทุจุฎ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ุฑูู ุงูููุจุงูู</label>
                    <input type="tel" id="userPhone">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">ุญูุธ ุงููุณุชุฎุฏู</button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="config/keys.js"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/realtime.js"></script>
    <script src="js/admin.js"></script>
    
    <script>
        window.addEventListener('DOMContentLoaded', () => {
            AdminDashboard.init();
        });
    </script>
</body>
</html>

